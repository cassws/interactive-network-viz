<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>Scrollama: Sticky Side Example</title>
	<meta name="description" content="Scrollama: Sticky Side Example">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel='stylesheet' href='../style.css'>
	<style>
		#scrolly {
			position: relative;
			display: -webkit-box;
			display: -ms-flexbox;
			display: flex;
			background-color: #f3f3f3;
			padding: 1rem;
		}

		#scrolly>* {
			-webkit-box-flex: 1;
			-ms-flex: 1;
			flex: 1;
		}


		article {
			position: relative;
			padding: 0 1rem;
			max-width: 66rem;
		}

		figure {
			position: -webkit-sticky;
			position: sticky;
			width: 100%;
			margin: 0;
			-webkit-transform: translate3d(0, 0, 0);
			-moz-transform: translate3d(0, 0, 0);
			transform: translate3d(0, 0, 0);
			background-color: #ebebeb;
		}

		figure p {
			text-align: center;
			padding: 1rem;
			position: absolute;
			top: 50%;
			left: 50%;
			-moz-transform: translate(-50%, -50%);
			-webkit-transform: translate(-50%, -50%);
			transform: translate(-50%, -50%);
			font-size: 8rem;
			font-weight: 900;
			color: #fff;
		}





		.step {
			/* margin: 0 auto 2rem auto; */
			background-color: #3b3b3b;
			color: #fff;
			padding: 2rem;
		}

		.step:last-child {
			margin-bottom: 0;
		}

		.step.is-active {
			background-color: #161616;
			color: white;
		}

		.step h1 {
			margin: 2rem;
		}

		.step p {
			/* text-align: center; */
			padding: 1rem;
			font-size: 1.25rem;
		}
	</style>

</head>

<body>
	<!-- <a href="https://github.com/russellgoldenberg/scrollama" target="_blank" class="github-corner"
		aria-label="View source on GitHub"><svg width="80" height="80" viewBox="0 0 250 250"
			style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
			<path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
			<path
				d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
				fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
			<path
				d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
				fill="currentColor" class="octo-body"></path>
		</svg></a> -->
	<main>
		<!-- <nav>
			<a href='https://github.com/russellgoldenberg/scrollama'>scrollama.js</a>
			<div class='nav__examples'>
				<p>Examples:</p>
				<a href='https://russellgoldenberg.github.io/scrollama/basic'>Basic</a>
				<a href='https://russellgoldenberg.github.io/scrollama/progress'>Progress</a>
				<a href='https://russellgoldenberg.github.io/scrollama/sticky-side'>Sticky Side</a>
				<a href='https://russellgoldenberg.github.io/scrollama/sticky-overlay'>Sticky Overlay</a>
			</div>
		</nav> -->
		<section id='intro'>
			<div id='introbox'>
				<h1 class='intro__hed'>Browse by people</h1>
				<p class='intro__dek'>
					Scroll to learn how the network visualization works.
				</p>
			</div>
		</section>

		<section id='scrolly'>

			<article>
				<div class='step' data-step='1'>
					<h1>Why visualize people as a network?</h1>
					<p>A <b>network graph</b> is a visual representation of the interconnections between many entities.
					</p>
					<p>When it comes to relationships between individuals, we often think of direct relationships:
						friendships, collaborations, romances. But individuals are also richly interconnected - through
						mutual acquaintences, through cities, and certainly through cafés. </p>

					<p>Let's take the example of Avrom Goldfaden, the "Father of Yiddish Theater". Here is is, shown as
						a circle or <b>node</b>. </p>
				</div>
				<div class='step' data-step='2'>
					<h1>Avrom Goldfaden</h1>
					<p>We know that Goldfaden is strongly linked to two places: Odessa, the city of his birth; and New
						York City, where he contributed to the burgeoning Yiddish theater community.</p>
					<p>We now have three entities (one person and two cities) we can visualize as nodes.</p>
					<p>To show Goldfaden is associated with both cities, we can draw lines connecting the nodes. These
						lines are called <b>edges</b> in network graphs.</p>
				</div>
				<div class='step' data-step='3'>
					<h1>Goldfaden and Alder</h1>
					<p>Although we may associate Goldfaden most strongly with New York, Odessa is where he made his
						first impression. Jacob Alder was one of the many Odessa residents who gathered in Café Fanconi
						gossiping about the theater scene. A year after his military service, Alder succeeded in joining
						Goldfaden's troupe in Odessa.</p>
					<p>Our graph now reflects the role Café Fanconi played in connecting Goldfaden and Alder.</p>
				</div>
				<div class='step' data-step='4'>
					<h1>The network grows</h1>
					<p>The encounter between Goldfaden and Alder represent only one of countless pathways of
						immigration, conversation, and happenstance that wove through Jewish cafés across the world.</p>
					<p>With each city, café, and individual, the network becomes more complex. The job of a network
						graph is to allow you to investigate specific pathways, as well as see big-picure patterns
						across hundreds of entities.</p>
					<p>Ready explore the network visualization as a whole? Click the link below.</p>
				</div>
			</article>

			<figure>
				<!-- <p>0</p> -->
			</figure>
		</section>

		<section id='outro'>
			<div style="text-align: center"><a href="https://mapping.judaic.lsa.umich.edu/people.html">View full visualization</a></div>
		</section>
	</main>

	<!-- <div class='debug'></div> -->
	<script src='https://unpkg.com/d3@5.9.1/dist/d3.min.js'></script>
	<script src='https://unpkg.com/intersection-observer@0.5.1/intersection-observer.js'></script>
	<script src='../stickyfill.min.js'></script>
	<script src='../scrollama.min.js'></script>
	<script>
		// using d3 for convenience
		var main = d3.select('main')
		var scrolly = main.select('#scrolly');
		var figure = scrolly.select('figure');
		var article = scrolly.select('article');
		var step = article.selectAll('.step');
		var link, node, height, width, svg;

		// initialize the scrollama
		var scroller = scrollama();

		// generic window resize listener event
		function handleResize() {
			// 1. update height of step elements
			var stepH = Math.floor(window.innerHeight * 0.66);
			step.style('height', stepH + 'px');

			var figureHeight = window.innerHeight * 0.66
			var figureMarginTop = (window.innerHeight - figureHeight) / 2

			figure
				.style('height', figureHeight + 'px')
				.style('top', figureMarginTop + 'px');


			// 3. tell scrollama to update new element dimensions
			scroller.resize();
		}

		// scrollama event handlers
		function handleStepEnter(response) {
			console.log(response)
			// response = { element, direction, index }

			// add color to current step only
			step.classed('is-active', function (d, i) {
				return i === response.index;
			})
			var URL = "";
			switch(response.index){
				case 0:
					URL = '../data_network_0.txt'
					break;
				case 1:
					URL = '../data_network_1.txt'
					break;
				case 2:
					URL = '../data_network_2.txt'
					break;
				case 3:
					URL = '../data_network_3.txt'
					break;

				
			}
			drawNetwork(URL)
			// update graphic based on step
			// figure.select('p').text(response.index + 1);
		}

		function setupStickyfill() {
			d3.selectAll('.sticky').each(function () {
				Stickyfill.add(this);
			});
		}

		function drawNetwork(current_step_URL) {
			console.log('stuff!')

			var width = 600;
			var height = window.innerHeight * 0.66;

			d3.select('figure').selectAll('svg').remove();

			svg = d3.select('figure')
				.append("svg")
				.attr("width", width)
				.attr("height", height)
				.append("g")
				.attr("transform",
					"translate(" + 50 + "," + 50 + ")");

			console.log('more!')

			d3.json(current_step_URL).then(function (data) {
				console.log(data.links)

				// Initialize the links
				link = svg
					.selectAll("line")
					.data(data.links)
					.enter()
					.append("line")
					.style("stroke", "#aaa")

				// Initialize the nodes
				node = svg
					.selectAll("circle")
					.data(data.nodes)
					.enter()
					.append("circle")
					.attr("r", 16)
					.style("fill", "#69b3a2")


				var simulation = d3.forceSimulation(data.nodes) // Force algorithm is applied to data.nodes
					.force("link", d3.forceLink() // This force provides links between nodes
						.id(function (d) {
							return d.id;
						}) // This provide  the id of a node
						.links(data.links) // and this the list of links
					)
					.force("charge", d3.forceManyBody().strength(-
					1600)) // This adds repulsion between nodes. Play with the -400 for the repulsion strength
					.force("center", d3.forceCenter(width / 2, height /
					2)) // This force attracts nodes to the center of the svg area
					.on("tick", ticked);

				console.log(simulation);
			})
			// This function is run at each iteration of the force algorithm, updating the nodes position.




			function ticked() {
				console.log('ticked')
				link
					.attr("x1", function (d) {
						return d.source.x;
					})
					.attr("y1", function (d) {
						return d.source.y;
					})
					.attr("x2", function (d) {
						return d.target.x;
					})
					.attr("y2", function (d) {
						return d.target.y;
					});

				node
					.attr("cx", function (d) {
						return d.x;
					})
					.attr("cy", function (d) {
						return d.y;
					});
			}
		}



		function init() {
			setupStickyfill();


			// 1. force a resize on load to ensure proper dimensions are sent to scrollama
			handleResize();

			// 2. setup the scroller passing options
			// 		this will also initialize trigger observations
			// 3. bind scrollama event handlers (this can be chained like below)
			scroller.setup({
					step: '#scrolly article .step',
					offset: 0.3,
					debug: false,
				})
				.onStepEnter(handleStepEnter)


			// setup resize event
			window.addEventListener('resize', handleResize);

			// drawNetwork(0);

		}

		// kick things off
		init();
	</script>
</body>

</html>